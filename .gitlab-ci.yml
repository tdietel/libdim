image: jasonbarrella/libdim:centos7


variables:
  EOS_PATH: ${RPM_EOS_PATH}/packages/centos7
  EOS_ACCOUNT_USERNAME: $EOS_SERV_USER
  EOS_ACCOUNT_PASSWORD: $EOS_SERV_PASS
  # CI_OUTPUT_DIR: /builds/jbarrell/libdim/RPMS

  
build:
  stage: build
  only:
    - master
  script:
    - ./bootstrap
    - ./configure
    - make
    - make rpm
    - chmod -R 755 /root/rpmbuild/RPMS
    - mkdir public && cp -r /root/rpmbuild/RPMS public/
  artifacts:
    paths:
    - RPMS/**

deployment:
  stage: deploy
  only:
    - master
  image: gitlab-registry.cern.ch/ci-tools/ci-web-deployer:latest
  script:
  - deploy-eos
      